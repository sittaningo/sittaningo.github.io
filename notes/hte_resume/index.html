<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Shingo Nitta">
<meta name="dcterms.date" content="2024-08-01">

<title>Shingo Nitta - 読書メモ：Brand et al.(2021)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../{{< fluent animal-turtle-20-regular >}}" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Shingo Nitta</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">HOME</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../profile/index.html" rel="" target="">
 <span class="menu-text">PROFILE</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../research/index.html" rel="" target="">
 <span class="menu-text">RESEARCH</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notes/index.html" rel="" target="">
 <span class="menu-text">NOTES</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">読書メモ：Brand et al.(2021)</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Readings</div>
    <div class="quarto-category">Social Inequality</div>
    <div class="quarto-category">Quantitative Method</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Shingo Nitta </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 1, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
購読文献
</div>
</div>
<div class="callout-body-container callout-body">
<p>Brand, Jennie E., Jiahui Xu, Bernard Koch, and Pablo Geraldo. 2021. “Uncovering Sociological Effect Heterogeneity Using Tree-Based Machine Learning.” <em>Sociological Methodology</em> 51(2):189–223. doi: 10.1177/0081175021993503.</p>
</div>
</div>
<section id="要約" class="level1">
<h1>要約</h1>
<section id="イントロダクション" class="level2">
<h2 class="anchored" data-anchor-id="イントロダクション">イントロダクション</h2>
<p>因果効果の異質性を研究することは希少な社会的資源がどのように社会で分配されているのか、あるイベントがその生起しやすさの異なる集団にたいしてどのように影響するのか、いかなる要因が効果の異質性を説明するのかにたいして価値ある視座を提供する。もし政策立案者が因果効果の異質性のパターンを理解していれば、政策介入を最適的(optimal)に実行できるようになる。</p>
<p>因果効果の異質性を検証するため、先行研究では異質性を生じさせるサブ集団(ジェンダー・学歴など)を先見的に措定したり、傾向スコア(処置を受ける確率)で層化したりして効果の差異を検証してきた。</p>
<ul>
<li><p>意味のあるサブ集団を同定するため、研究者は何十何百もの回帰分析を走らせることがあるが(p-hacking)、この手続きを踏んだ統計的推論は妥当ではない</p></li>
<li><p>かりに意味のあるサブ集団を同定できたとしても、複数の共変量を同時に、非線形に考える必要がある(e.g., 「白人男性」より「信仰心の強い、高収入層の白人男性」)</p></li>
</ul>
<p>本論文ではより意味のあるサブ集団を透明性高く同定するためのデータドリブンな機械学習の手法について論じる。機械学習の手法はモデル選択過程を系統化し、正確な予測を達成することから近年社会科学で急速に発展している。決定木、なかでも因果木(causal tree)と呼ばれる手法が因果効果の異質性を簡単に、そして解釈可能に捉えるために適している。</p>
<p>本論文では(1) 逆確率重み付け(IPW)、(2) 最近傍マッチング、(3) ダブリーロバスト因果フォレストの3つの手法を、社会学的意義のある観察データにたいしてどのように効率的に適用するのかを示す。そして、たんに特定の共変量や傾向スコアで層化することに比べて因果木はより応答的で(responsive)、理論的に興味深いサブ集団を同定することを論じる。</p>
</section>
<section id="因果効果の異質性をひらく" class="level2">
<h2 class="anchored" data-anchor-id="因果効果の異質性をひらく">因果効果の異質性をひらく</h2>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Notation
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p><span class="math inline">\(i = 1, \cdots, n\)</span>：個体(個人、職業、地域など)</p></li>
<li><p><span class="math inline">\(Y_i\)</span>：個体<span class="math inline">\(i\)</span>のアウトカム(従属変数、被説明変数)</p></li>
<li><p><span class="math inline">\(W_i \in {0, 1}\)</span>：個体<span class="math inline">\(i\)</span>の処置(独立変数、説明変数、ただし二値とする)</p></li>
<li><p><span class="math inline">\(X_i\)</span>：個体<span class="math inline">\(i\)</span>の処置前の共変量</p></li>
</ul>
</div>
</div>
<section id="平均因果効果の定義" class="level3">
<h3 class="anchored" data-anchor-id="平均因果効果の定義">平均因果効果の定義</h3>
<p>因果効果の定義は <a href="#eq-ite">Equation&nbsp;1</a> の通り。同じ個人に対して処置を与えた場合と与えなかった場合のアウトカムの差。</p>
<p><span id="eq-ite"><span class="math display">\[
\tau_i = Y^1_i - Y^0_i
\tag{1}\]</span></span></p>
<p>ただし実際には同じ人に処置を与えている状況と与えていない状況を同時に観察できない。さまざまな追加的仮定が必要だが、観察データでは、交絡なし(<span class="math inline">\(X\)</span>を条件付ければ、処置とアウトカムは独立)の仮定を置く。</p>
<p><span id="eq-unconfoundedness"><span class="math display">\[
W_i \coprod (Y^1_i, Y^0_i) \mid X_i
\tag{2}\]</span></span></p>
<p><a href="#eq-unconfoundedness">Equation&nbsp;2</a> を完全にノンパラメトリックに行うのは不可能<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>。その代わりに共変量が’近い’個体をマッチさせて因果効果を推定する。そのアプローチの1つが傾向スコア(共変量を条件づけたときに個体が処置を受ける確率)であり、<span class="math inline">\(e(x)\)</span>として <a href="#eq-propensityscore">Equation&nbsp;3</a> のように 表現される。</p>
<p><span id="eq-propensityscore"><span class="math display">\[
e(x) = pr(W_i = 1 \mid X_i = x)
\tag{3}\]</span></span></p>
</section>
<section id="共変量および傾向スコアに基づいた分割" class="level3">
<h3 class="anchored" data-anchor-id="共変量および傾向スコアに基づいた分割">共変量および傾向スコアに基づいた分割</h3>
<p>社会学者が伝統的におこなっている共変量分割は条件付き因果効果(conditional average treatment effect、CATE)として <a href="#eq-catecovariates">Equation&nbsp;4</a> 、<a href="#eq-catepropscore">Equation&nbsp;5</a> のようにに表現される(それぞれ共変量と傾向スコアで表現したもの)。</p>
<p><span id="eq-catecovariates"><span class="math display">\[
\tau(x) = E [ Y^1_i - Y^0_i \mid X_i = x ]
\tag{4}\]</span></span></p>
<p><span id="eq-catepropscore"><span class="math display">\[
\tau(e(x)) = E [ Y^1_i - Y^0_i \mid e(X_i) = e(x) ]
\tag{5}\]</span></span></p>
</section>
<section id="木ベースの機械学習" class="level3">
<h3 class="anchored" data-anchor-id="木ベースの機械学習">木ベースの機械学習</h3>
<p>教師あり機械学習はあるデータで訓練させ、別のデータでそれを検証する。訓練データをあまりに厳密に予測しすぎると別のデータに一般化できなくなるため(過学習)、ほかのデータに移転できるくらい程よく柔軟なアルゴリズムが得られる。</p>
<p>決定木(decision tree)は共変量の閾値にそって、データの類似性が高い(分散が小さい)部分集合に繰り返し分割する。各決定で平均二乗誤差(mean squared error、MSE)を最小化する共変量とその閾値を選択する。このアプローチは都度MSEを最小化する結果、データ全体の異質性を大域的には捉えられないデメリットも持つ。訓練データのリサンプリング(bagging)と共変量のランダムな選定を複数回行い平均化するランダムフォレストを適用し、この問題に対処する。</p>
</section>
<section id="因果木を使用した繰り返しの分割" class="level3">
<h3 class="anchored" data-anchor-id="因果木を使用した繰り返しの分割">因果木を使用した繰り返しの分割</h3>
<p>社会学的意義の大きい手法として、 <span class="citation" data-cites="Athey.2016zq5">Athey and Imbens (<a href="#ref-Athey.2016zq5" role="doc-biblioref">2016</a>)</span> が開発した潜在アウトカムのアプローチにもとづく因果木のアルゴリズムに着目する。ある木(ある分割群<span class="math inline">\(\prod\)</span>)は分割された共変量空間 <span class="math inline">\(\mathbb{X}\)</span> と一致する。<span class="math inline">\(\mathbb{X}\)</span>を相互排他的な<span class="math inline">\(M\)</span>個の葉<span class="math inline">\(l_1, \cdots, l_M\)</span>に分割し、各<span class="math inline">\(l_1, \cdots, l_{M-1}\)</span><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>で訓練したアウトカムの平均を<span class="math inline">\(l_M\)</span>の個体のアウトカムにたいして推定する。因果木では(観測されたアウトカム<span class="math inline">\(Y\)</span>ではなく)因果効果<span class="math inline">\(\tau\)</span>(=潜在アウトカム)を最も良く予測するような決定木を適用する。</p>
<p><span class="citation" data-cites="Athey.2016zq5">Athey and Imbens (<a href="#ref-Athey.2016zq5" role="doc-biblioref">2016</a>)</span> はオネスト推定も提案している。データを訓練用<span class="math inline">\(S^{tr}\)</span>と検証用<span class="math inline">\(S^{es}\)</span>に分け、<span class="math inline">\(S^{tr}\)</span>で木を構築し(すなわち、最も精度良い分類をし)、<span class="math inline">\(S^{es}\)</span>で各葉<span class="math inline">\(l_1, \cdots, l_M\)</span>固有の因果効果を求める。オネスト推定と潜在アウトカムのための期待(expected)MSEとして <a href="#eq-emse">Equation&nbsp;6</a> を定義している。</p>
<p><span id="eq-emse"><span class="math display">\[
-\hat{EMSE}_{\tau(x)} = \frac{1}{N^{tr}} \Sigma_{i \in S{tr}} \hat{\tau}^2 \left(X_i; S^{tr}, \prod \right) - \left( \frac{1}{N^{tr}} + \frac{1}{N^{es}} \right) \Sigma_{i \in \prod} \left( \frac{S^2_{S^{tr}(1)} (l)}{p(l)} + \frac{S^2_{S^{tr}(0)}(l)}{1 - p(l)} \right)
\tag{6}\]</span></span></p>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<a href="#eq-emse">Equation&nbsp;6</a> のNotation
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li><p><span class="math inline">\(N^{tr}, N^{es}\)</span>：訓練(検証)データのサイズ</p></li>
<li><p><span class="math inline">\(\prod\)</span>：共変量空間の潜在的な分割</p></li>
<li><p><span class="math inline">\(S^2_{S^{tr}(1)} (l) + S^2_{S^{tr}(0)}\)</span>：葉<span class="math inline">\(l\)</span>における処置群と対照群のサンプル分散</p></li>
<li><p><span class="math inline">\(p(l)\)</span>：葉<span class="math inline">\(l\)</span>における処置群の割合</p></li>
</ul>
</div>
</div>
</div>
<p>第一項は各葉の因果効果の分散を、第二項は因果効果の不確実性を示している。キモは<span class="math inline">\(N^{es}\)</span>の処置効果による不確実性を考慮しているところにある。言い換えれば、効果の異質性を適切に捉えると同時に、捉えた異質性のなかでは推定精度が高くある状況をオネスト推定は目指している。結果として捉える条件付き平均因果効果(CATE)は <a href="#eq-catetree">Equation&nbsp;7</a> のように表現される。</p>
<p><span id="eq-catetree"><span class="math display">\[
\tau(x; \prod) = E \left[ Y^1_i - Y^0_i \mid X_i \in l(x; \prod) \right]
\tag{7}\]</span></span></p>
<div id="fig-covpart" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="fig/fig1.jpg" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;1: オネスト推定の具体的な手続き<br>Source: <span class="citation" data-cites="Brand.2021">Brand et al. (<a href="#ref-Brand.2021" role="doc-biblioref">2021</a>)</span> Figure1より引用</figcaption>
</figure>
</div>
<p>細々した議論。因果木には交絡なしの仮定が伴う。また、共変量は処置の前にあるもののみを含める必要がある。コモンサポート（マッチングにおいて、マッチしない集団が分析から除外されてしまうこと）の問題もなお残る。</p>
<p>因果木は実証的探索、重要な共変量の発見、解釈可能性という点で強みを発揮する。因果木は分析の前では想定されなかった有意味な共変量を析出し、サンプルを分割してアウトカムを予測する慣習的な機械学習の代わりに、不偏平均因果効果の推定をも可能にする。因果木は単一の簡単な解釈可能性を提供こそしないが、異質性の普遍検定（omnibus test）や共変量の重要性を通じて解釈を助ける。</p>
</section>
</section>
<section id="実証への適用" class="level2">
<h2 class="anchored" data-anchor-id="実証への適用">実証への適用</h2>
<p>大卒が賃金(低賃金職の時間)に与える効果の異質性を以下4つの課題として検証する。データはNLSY1979-2014を用いる。</p>
<ol type="1">
<li><p>大学修了は賃金労働に従事する時間の割合を減少させるのか？</p></li>
<li><p>低賃金労働に対する大学の効果は、傾向スコア層や、大学修了の可能性に影響する主要な共変量（親の収入、母親の学歴、測定された能力、人種）によって異なるのか？</p></li>
<li><p>低賃金労働に対する大学修了の効果は、我々が考慮しなかったサブグループによって異なるか？</p></li>
<li><p>処置効果の推定値は、分割間の未観測交絡に対してどの程度敏感か？</p></li>
</ol>
<table class="table">
<caption>大学修了が低賃金労働に与える総効果。括弧内は標準誤差。IPWは逆確率重み付けを示す。<br>Source: <span class="citation" data-cites="Brand.2021">Brand et al. (<a href="#ref-Brand.2021" role="doc-biblioref">2021</a>)</span> Table2より引用</caption>
<colgroup>
<col style="width: 35%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 18%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th>低賃金労働に従事する時間の割合</th>
<th>調整なし</th>
<th>IPW</th>
<th>最近傍マッチング</th>
<th>因果木</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>大学修了</td>
<td>-.223**(0.13)</td>
<td>-.189**(0.16)</td>
<td>-.174**(0.23)</td>
<td>-.176**(0.24)</td>
</tr>
</tbody>
</table>
<p><a href="#fig-covpart">Figure&nbsp;2</a> は傾向スコアおよび共変量別のCATEを、<a href="#fig-causaltree">Figure&nbsp;3</a> は因果木を用いた共変量分割パターンを示している。因果木は理論的予想にはない集団を同定できている：母学歴(母高卒)については考えていたが、大家族で育ち、社会的コントロールが低い高卒の母親や、高卒より学歴の高い、認知能力の高い母親については考えていなかった。</p>
<div id="fig-covpart" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="fig/fig2.jpg" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2: 傾向スコアおよび共変量でたんに分割したCATE<br>Source: <span class="citation" data-cites="Brand.2021">Brand et al. (<a href="#ref-Brand.2021" role="doc-biblioref">2021</a>)</span> Figure2より引用</figcaption>
</figure>
</div>
<div id="fig-causaltree" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="fig/fig4.jpg" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3: 因果木のアルゴリズムにもとづいて分割したCATE<br>Source: <span class="citation" data-cites="Brand.2021">Brand et al. (<a href="#ref-Brand.2021" role="doc-biblioref">2021</a>)</span> Figure4より引用</figcaption>
</figure>
</div>
<p>因果木の安定性を鑑みて、4000本の因果フォレストをおこない、各特徴量の相対的な重要度を <a href="#fig-importance">Figure&nbsp;4</a> に示した。上6つの変数が <a href="#fig-causaltree">Figure&nbsp;3</a> で選択共変量と大きく重なっており、 <a href="#fig-causaltree">Figure&nbsp;3</a> の因果木が重要な共変量を選択していることがわかる。</p>
<div id="fig-importance" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="fig/fig6.jpg" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;4: 因果フォレストによる相対的重要度のプロット<br>Source: <span class="citation" data-cites="Brand.2021">Brand et al. (<a href="#ref-Brand.2021" role="doc-biblioref">2021</a>)</span> Figure6より引用</figcaption>
</figure>
</div>
</section>
<section id="議論" class="level2">
<h2 class="anchored" data-anchor-id="議論">議論</h2>
<p>全員が処置の効果を均等に受けるとはかぎらない。異質性は長らく検討されてきた議題だが、社会学者は伝統的に先見的にサブ集団への分割をしてきた（もちろん、それ自体が理論的関心となるからだが）。ただし、つねに異質性を完全に把握できるとは限らない。社会学者は何百もの回帰を走らせてデータドリブンな異質性を把握してきたが、それはp-hackingの見地からは疑わしい。</p>
<p>本論文で用いたcausal treeはオネスト推定を用いることで、葉内の予測力を最大化する仕方で感応的なサブ集団を同定する。本論文では社会学の主要な研究課題である大学の賃金への効果に応用した。当然、実証タスクの自動化は共変量のインバランス、交絡、結果の解釈の責任から逃れられるわけではない。我々は、効果の異質性に関心のある社会学者に対して、因果木を応用して、より明確な探索を用い、効果の異質性を探求するための研究実践を改善するよう促している。</p>
<!-- # コメント

- 引退が健康に与える影響の異質性について研究しようと考えていたのでこの論文を選定した。この論文の2年前にmeta-learnerと呼ばれるより良い手法が開発されているらしい[@Künzel.2019; @Hu.2022]。だが、meta-learnerは共変量分割ができない＝どの共変量がどのようなパターンとして効果の異質性を生じさせているのかがわからないため[@Hu.2022]、因果木の方が解釈可能性という点で優れているという印象を持った。

- 最初は共変量の重要度は介入の順序を同定するとか、理論間の重要性を比較するような枠組みにも使えるかなと思っていたが、本論文ではあくまで因果木のロバストネスチェックとして使われていた。因果木のキモがある意味での三重、四重交互作用の同定にあるのであれば、1つの変数の重要度を見るだけでは意味がないのかもしれないと思ったので、介入の順序を同定するとか、理論間の重要性を比較するというのは因果木では難しいと考え直した(その点、解釈可能なAIの枠組みにおけるSharpley valueとの差分になるのかもと思った)。

- reference groupの設定が難しい。@fig-causaltree で分割したグループのうち$-.34$と$-.086$の差はなんとなくありそうだが、それ(最大-最小)を比較するべきなのか。あるいは、平均処置効果との距離から異質性を評価するべきなのか、ということについても議論が欲しかった。

- 因果木を使うとより透明な仕方で探索ができると書かれているが、それは誤っていると考えた。あらゆるデータにおいて共変量は(たった!)有限個であり、それを使って探索するというのは、確証的な探索的分析に過ぎないのではないか。そういう意味ではいかなる特徴量でデータが条件づけられているのかを分析に先立って明示的に述べておく(@Lundberg.2021 でいうところの実証的エスティマンド、link to observables)ことが探索的分析においても重要だと思った。 -->



</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-Athey.2016zq5" class="csl-entry" role="listitem">
Athey, Susan, and Guido Imbens. 2016. <span>“<span class="nocase">Recursive partitioning for heterogeneous causal effects</span>.”</span> <em>Proceedings of the National Academy of Sciences</em> 113 (27): 7353–60. <a href="https://doi.org/10.1073/pnas.1510489113">https://doi.org/10.1073/pnas.1510489113</a>.
</div>
<div id="ref-Brand.2021" class="csl-entry" role="listitem">
Brand, Jennie E., Jiahui Xu, Bernard Koch, and Pablo Geraldo. 2021. <span>“<span>Uncovering Sociological Effect Heterogeneity Using Tree-Based Machine Learning</span>.”</span> <em>Sociological Methodology</em> 51 (2): 189–223. <a href="https://doi.org/10.1177/0081175021993503">https://doi.org/10.1177/0081175021993503</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>たとえば、OLS回帰(<span class="math inline">\(y = \alpha + \beta_1 x_1 + \beta_2 x_2 + \epsilon\)</span>、ただし<span class="math inline">\(x_1\)</span>は比尺度とする)は、<span class="math inline">\(x_1\)</span>と<span class="math inline">\(x_2\)</span>が交互作用をとらない(すなわち、<span class="math inline">\(\beta_1 x_1 \times \beta_2 x_2\)</span>ではない)こと、<span class="math inline">\(x_1\)</span>は線形である(特定の閾値で効果が変わらない)ことを仮定している。<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>原文には<span class="math inline">\(l_M\)</span>の個体のアウトカムにたいして推定するとしか書かれておらず、訓練データに<span class="math inline">\(l_M\)</span>を含めるかどうかは書かれていない。ただし、通常は含めないと思われるため、<span class="math inline">\(l_1, \cdots, l_{M-1}\)</span>と表記している。<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>